var sbi_installer=sbi_installer||{};function checkValue(t,a){for(var l=0;l<a.length;l++)if(a[l]==t)return!0;return!1}jQuery(document).ready(function(n){"use strict";n("#sbi-permalink-list .button").click(function(){var t=n("#permalink"),a=n(this);""===t.val()&&t.val("/"),-1!==t.val().search(a.html())?t.val(t.val().replace(a.html()+"/","")):t.val(t.val()+a.html()+"/")});var s=!1;n("#sbi-danger-button").click(function(){n(".sbi-danger-buttons").toggle()}),n("#sbi-install-button").click(function(){sbi_installer.operate_plugins(n(this),"sbi_plugins_installer","install")}),n("#sbi-delete-button").click(function(){sbi_installer.operate_plugins(n(this),"sbi_plugins_operate","delete")}),n("#sbi-activate-button").click(function(){sbi_installer.operate_plugins(n(this),"sbi_plugins_operate","activate")}),n("#sbi-deactivate-button").click(function(){sbi_installer.operate_plugins(n(this),"sbi_plugins_operate","deactivate")}),sbi_installer.operate_plugins=function(i,t,a){s=!0,i.addClass("installing"),n.ajax({type:"POST",url:sbi_installer_localize.ajax_url,data:{action:t,nonce:sbi_installer_localize.admin_nonce,make:a,dataType:"json"},success:function(l){switch(l&&i.removeClass("installing"),s=!1,a){case"install":n("#the-list-blueprint .plugin-card .action-links a.button").each(function(t){var a=n(this);checkValue(a.data("slug"),l.installed)&&(a.attr("class","activate button button-primary"),a.html(sbi_installer_localize.activate_btn))});break;case"delete":n(".plugin-card").remove();break;case"activate":n("#the-list-blueprint .plugin-card .action-links a.button").each(function(t){var a=n(this);checkValue(a.data("slug"),l.activate)&&a.hasClass("activate")&&(a.attr("class","installed button disabled"),a.html(sbi_installer_localize.installed_btn))});break;case"deactivate":n("#the-list-blueprint .plugin-card .action-links a.button").each(function(t){var a=n(this);a.data("slug");a.hasClass("disabled")&&(a.attr("class","activate button button-primary"),a.html(sbi_installer_localize.activate_btn))})}},error:function(t,a,l){console.log(a),i.removeClass("installing"),s=!1,location.reload(!0)}})},sbi_installer.install_plugin=function(i,t){s=!0,i.addClass("installing"),n.ajax({type:"POST",url:sbi_installer_localize.ajax_url,data:{action:"sbi_plugin_installer",plugin:t,nonce:sbi_installer_localize.admin_nonce,dataType:"json"},success:function(t){t&&"success"===t.status?(i.attr("class","activate button button-primary"),i.html(sbi_installer_localize.activate_btn)):i.removeClass("installing"),s=!1},error:function(t,a,l){console.log(a),i.removeClass("installing"),s=!1}})},sbi_installer.activate_plugin=function(a,t){n.ajax({type:"POST",url:sbi_installer_localize.ajax_url,data:{action:"sbi_plugin_activation",plugin:t,nonce:sbi_installer_localize.admin_nonce,dataType:"json"},success:function(t){t&&"success"===t.status&&(a.attr("class","installed button disabled"),a.html(sbi_installer_localize.installed_btn)),s=!1},error:function(t,a,l){console.log(a),s=!1}})},n(document).on("click","#the-list-blueprint .plugin-card .action-links a.button",function(t){var a=n(this),l=a.data("slug");if(t.preventDefault(),!a.hasClass("disabled")){if(s)return!1;a.hasClass("install")&&sbi_installer.install_plugin(a,l),a.hasClass("activate")&&sbi_installer.activate_plugin(a,l)}})});